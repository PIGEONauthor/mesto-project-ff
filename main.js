(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{authorization:"278bb077-1673-45bd-9597-3e9d7ec352d4","Content-Type":"application/json"}},t=function(){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(o)},n=function(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(o)},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(res.status))};function r(e,t,n,o){var r=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);r.id=e._id;var c=r.querySelector(".card__image"),a=r.querySelector(".card__delete-button"),i=r.querySelector(".card__title"),u=r.querySelector(".card__like-button"),s=r.querySelector(".card__like-count"),l="0a4ac5110e6af2907d16b39b",d=e.likes.find((function(e){return e._id===l}));return c.src=e.link,c.alt=i.textContent=e.name,s.textContent=e.likes.length,c.addEventListener("click",n),e.owner._id!=l?a.style.display="none":a.addEventListener("click",(function(){t(r.id)})),d&&u.classList.add("card__like-button_is-active"),u.addEventListener("click",(function(){o(u,s,r.id)})),r}function c(t,n,r){t.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then(o)}(r).then((function(e){t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then(o)}(r).then((function(e){t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){console.log(e)}))}function a(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated")}),0),document.addEventListener("keydown",u),document.addEventListener("mousedown",s)}function i(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.remove("popup_is-opened")}),0),setTimeout((function(){e.classList.remove("popup_is-animated")}),600),document.removeEventListener("keydown",u),document.removeEventListener("mousedown",s)}function u(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function s(e){e.target.classList.contains("popup_is-opened")&&i(e.target)}function l(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o)}function d(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function p(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){l(e,n,t.inputErrorClass,t.errorClass)})),o.classList.add(t.inactiveButtonClass)}var f=[t,n],m=document.querySelector(".popup_type_edit"),_=document.querySelector(".profile__edit-button"),h=document.forms["edit-profile"],v=h.elements.name,y=h.elements.description,b=h.querySelector(".popup__button"),S=document.querySelector(".profile__image"),L=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),C=document.querySelector(".popup_type_edit-avatar"),E=document.querySelector(".profile__image-edit"),k=document.forms["edit-avatar"],g=k.elements.url,x=k.querySelector(".popup__button"),T=document.querySelector(".popup_type_new-card"),U=document.querySelector(".profile__add-button"),w=document.querySelector(".popup_type_delete-card"),A=document.forms["new-place"],B=A.elements["place-name"],D=A.elements.link,P=A.querySelector(".popup__button"),j=document.forms["delete-card"],N=j.querySelector(".popup__button"),O=document.querySelector(".popup_type_image"),J=O.querySelector(".popup__image"),M=O.querySelector(".popup__caption"),z=document.querySelectorAll(".popup__close"),H=document.querySelector(".places__list"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function V(e){J.src=e.target.src,J.alt=M.textContent=e.target.alt,a(O)}function F(e){N.dataset.id=e,a(w)}function G(e){i(e.target.closest(".popup"))}Promise.all(f).then((function(){t().then((function(e){e.forEach((function(e){!function(e,t){t.append(r(e,F,V,c))}(e,H)}))})),n().then((function(e){L.textContent=e.name,q.textContent=e.about,S.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.log(e)}))})),E.addEventListener("click",(function(){k.reset(),p(k,I),a(C)})),_.addEventListener("click",(function(){v.value=L.textContent,y.value=q.textContent,p(h,I),a(m)})),U.addEventListener("click",(function(){A.reset(),p(A,I),a(T)})),z.forEach((function(e){e.addEventListener("click",G)})),h.addEventListener("submit",(function(t){t.preventDefault(),b.textContent="Сохранение...",function(t,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:n})}).then(o)}(v.value,y.value).then((function(e){L.textContent=e.name,q.textContent=e.about,i(m)})).catch((function(e){console.log(e)})).finally((function(){b.textContent="Сохранить"}))})),k.addEventListener("submit",(function(t){var n;t.preventDefault(),x.textContent="Сохранение...",(n=g.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then(o)).then((function(e){S.style.backgroundImage="url('".concat(e.avatar,"')"),i(C)})).catch((function(e){console.log(e)})).finally((function(){x.textContent="Сохранить"}))})),A.addEventListener("submit",(function(t){t.preventDefault(),P.textContent="Сохранение...";var n,a,u={name:B.value,link:D.value};(n=u.name,a=u.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:a})}).then(o)).then((function(e){H.prepend(r(e,F,V,c)),i(T)})).catch((function(e){console.log(e)})).finally((function(){P.textContent="Сохранить"}))})),j.addEventListener("submit",(function(t){t.preventDefault();var n,r=N.dataset.id;(n=r,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(o)).then((function(){document.querySelector("[id='".concat(r,"']")).remove(),i(w)})).catch((function(e){console.log(e)}))})),function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){!function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll("".concat(t))),i=e.querySelector(n);d(a,i,o),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?l(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));c.textContent=n,t.classList.add(o),c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),d(a,i,o)}))}))}(t,e.inputSelector,e.submitButtonSelector,e.inactiveButtonClass,e.inputErrorClass,e.errorClass)}))}(I),fetch("https://nomoreparties.co/v1/wff-cohort-1/cards",{headers:{authorization:"278bb077-1673-45bd-9597-3e9d7ec352d4"}}).then((function(e){return e.json()})).then((function(e){return console.log(e)}))})();